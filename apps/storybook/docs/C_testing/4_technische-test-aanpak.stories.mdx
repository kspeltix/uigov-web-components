import {Meta} from '@storybook/addon-docs';

<Meta title="Testing/Technische Test Aanpak"/>

# Technische Test Aanpak

## Inleiding

Bij Departement Omgeving wordt typisch Selenium gebruikt voor frontend testen. Selenium wordt algemeen veel gebruikt,
is goed gedocumenteerd, maar niet ideaal. Het artikel
[cypress, the selenium killer](https://blog.logrocket.com/cypress-io-the-selenium-killer/) beschrijft de problemen die
ik typisch ook ervaar met Selenium.

Een aantal algemene artikels die Selenium goed beschrijven zijn:

- de [Selenium website](https://www.selenium.dev)
- de [Selenium wikipedia](https://en.wikipedia.org/wiki/Selenium_(software)) pagina
- een [introductie tot Selenium](https://www.guru99.com/introduction-to-selenium.html)

Selenium heeft een [flexibele architectuur](https://www.interviewbit.com/blog/selenium-architecture) met web-driver's
waardoor het historisch een breed scala van talen om testen in te schrijven ondersteund. Typisch werden deze testen
(vroeger in [SSR toepassingen](/story/testing-test-piramide-ssr-vs-spa--page)) in dezelfde taal als de applicatie (bij
DOMG dus in Java) geschreven. Toepassingen zijn geëvolueerd richting SPA's, in JavaScript geschreven. Daar Selenium ook
JavaScript ondersteuning heeft is dan vaak die test tool behouden. In de opzet van een SPA zijn er echter betere
alternatieven.


## Selenium Kenmerken

Volgende zaken zijn kenmerken van Selenium testen die niet ideaal zijn voor een SPA:


### Page Object Model

De [POM](https://www.selenium.dev/documentation/test_practices/encouraged/page_object_models/) aanpak die vaak
gebruikt wordt is zinvol voor SSR's, je hebt verschillende pagina's met hun eigen url. Er is een 1 op 1 mapping
van de pagina met het POM. Voor een SPA is dat lastiger, er is maar 1 page waarbinnen alles dynamisch gebeurd.
Vasthouden aan het POM kan, maar zal niet eenduidig zijn.


### Wachten

Selenium stamt uit 2004, een tijd waar de aanpak om een webtoepassing te schrijven was: het dynamisch maken van
meerdere statische pagina's. Als het dynamische er uit bestond te antwoorden met een volledig nieuwe pagina werkte
Selenium perfect: het selecteren en verifiëren van aanwezige DOM elementen lukt feilloos. Vanaf dat er AJAX
(Asynchronous JavaScript And XML) gebruikt werd, lag het al moeilijker. De feitelijke DOM-structuur wijzigt dan
ten gevolge van gebruiker acties. Doordat AJAX bewust en gecontroleerd gebruikt werd, viel het nog wel mee om
een Selenium test te schrijven. Je gebruikt typisch het patroon: wachten tot 'iets verwacht' gebeurd, om daarna
verder te gaan.


## Flaky Testen

[Flaky testen](https://www.jetbrains.com/teamcity/ci-cd-guide/concepts/flaky-tests/) zijn testen die typisch lukken,
maar 'soms' niet. De soms hangt af van randvoorwaarden als: de snelheid van de computer waar de testen / de toepassing
op draaien, extra belastingen van het systeem, een trager netwerk, ... .
Des te dynamischer toepassingen worden, des te flaky-er testen worden. De oorzaak is nooit het test framework,
een tool die de problematiek echter in acht neemt kan flakyness wel beperken en beheersbaar maken.

Oorzaken van flakyness zijn vaak asychrone gebeurtenissen:

- door het gebruik van promises, async/await, observables (RxJS)<br/>
  -> eventueel ten gevolge van het maken van een reactive toepassing
- events die gebeuren vanuit de server kant: via SSE of een websocket


## Eenduidigheid

Volgende factoren maken het minder eenduidig maken wat er in de DOM gebeurd:

- bij een responsive toepassing zullen afhankelijk van de resolutie waarop getest wordt elementen onzichtbaar worden,
  een ander formaat of andere positie hebben
- door web-componenten met een shadow DOM is de DOM-structuur minder transparant
- frameworks en component bibliotheken doen soms auto-magische zaken


## Selenium en SPA's

TODO of niet TODO


## Cypress

[Cypress](https://www.cypress.io/)
https://www.perfecto.io/blog/cypress-vs-selenium-whats-right-cross-browser-testing-solution-you
https://www.browserstack.com/guide/cypress-vs-selenium
https://www.blazemeter.com/blog/selenium-vs-cypress


## OpenWC Testing

[web-component-tester](https://www.npmjs.com/package/web-component-tester)
[OpenWC Testing](https://open-wc.org/docs/testing/testing-package/)


## Storybook
